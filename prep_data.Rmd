---
title: "Predictive Modeling"
author: "Nelson Roque"
date: "2/27/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(tidyverse)
library(equatiomatic)
```

# LOAD DATA ----

```{r}

# load data
exp_df <- read_csv("data/exp1.csv")

```

# PRE-PROCESS DATA ----
```{r}
# reformat datetime
exp_pp <- exp_df %>%
  filter(!is.na(PARTICIPANT)) %>%
  mutate(DT_ = anytime::anytime(datetime))
```

```{r}
# create additional columns, remove columns
exp_pp_ = exp_pp %>%
  mutate(is_practice = ifelse(practice == "yes", TRUE, FALSE)) %>%
  mutate(TRIAL = count_trial_sequence) %>%
  mutate(DT_DOW = lubridate::wday(DT_),
         DT_DOY = lubridate::yday(DT_),
         DT_HOUR = lubridate::hour(DT_)) %>%
  select(-count_trial_sequence, -response_time, -practice) %>%
  select(datetime, contains("DT_"), PARTICIPANT, BLOCK, TRIAL, is_practice, correct, RT, everything()) %>%
  mutate(EXP_BLOCK_RANDOM = ifelse(isRandom == "blocked", FALSE, TRUE))
```

```{r}
# metadata
metadata = exp_pp_  %>%
  select(datetime, contains("DT_"), PARTICIPANT, contains("EXP_")) %>%
  distinct()
```

# QUICK SUMMARIES ----

```{r}
# overall means and record count by participant
part_means = exp_pp_ %>%
  group_by(PARTICIPANT, datetime) %>%
  summarise(mean_rt = mean(RT, na.rm=T),
            sd_rt = sd(RT, na.rm=T),
            q10_rt = quantile(RT, probs=0.1, na.rm=T),
            q90_rt = quantile(RT, probs=0.9, na.rm=T),
            n_correct = sum(correct),
            n = n()) %>%
  inner_join(metadata)

# overall means by block
part_means_byblock = exp_pp_ %>%
  group_by(PARTICIPANT, datetime, BLOCK, is_practice) %>%
  summarise(mean_rt = mean(RT, na.rm=T),
            sd_rt = sd(RT, na.rm=T),
            q10_rt = quantile(RT, probs=0.1, na.rm=T),
            q90_rt = quantile(RT, probs=0.9, na.rm=T),
            n_correct = sum(correct),
            n = n()) %>%
  inner_join(metadata)
```

# QUICK VIZ ----

```{r}
ggplot(part_means_byblock %>% filter(!is_practice), aes(BLOCK, mean_rt, group=BLOCK, color=EXP_BLOCK_RANDOM)) + 
  geom_boxplot() +
  facet_grid(. ~ EXP_BLOCK_RANDOM) +
  theme_bw() +
  labs(x= "Experiment Block", y = "Mean Response Time (ms)")
```

# PREDICTIVE MODELING ----

```{r}
fit = lm(mean_rt ~ BLOCK, data=part_means_byblock)
summary(fit)
extract_eq(fit, use_coefs=TRUE, wrap=TRUE)

fit_mlm  = lme4::lmer(mean_rt ~ 1 + (1|PARTICIPANT),
                      data=exp_pp_)
```